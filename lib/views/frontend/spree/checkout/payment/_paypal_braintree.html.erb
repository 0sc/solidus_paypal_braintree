<% address = current_order.ship_address %>
<% id = payment_method.id %>

<%= render "spree/shared/paypal_braintree_head_scripts" %>

<% if current_store.braintree_configuration.paypal? %>
  <%= render "spree/shared/paypal_checkout_button" %>
<% end %>

<% if current_store.braintree_configuration.credit_card? %>
  <fieldset class="braintree-hosted-fields" data-braintree-hosted-fields data-id="<%= id %>">
    <%= render "spree/shared/braintree_hosted_fields", id: id %>
  </fieldset>
<% end %>

<% if current_store.braintree_configuration.apple_pay? %>
  <button id="apple-pay-button" class="apple-pay-button"></button>
  <script>
    var applePayButtonElement = document.getElementById('apple-pay-button');
    var applePayOptions = {
      paymentMethodId: <%= id %>,
      storeName: "<%= current_store.name %>",
      orderEmail: "<%= current_order.email %>",
      amount: "<%= current_order.total %>",
      shippingContact: {
        emailAddress: '<%= current_order.email %>',
        familyName: '<%= address.firstname %>',
        givenName: '<%= address.lastname %>',
        phoneNumber: '<%= address.phone %>',
        addressLines: ['<%= address.address1 %>','<%= address.address2 %>'],
        locality: '<%= address.city %>',
        administrativeArea: '<%= address.state.name %>',
        postalCode: '<%= address.zipcode %>',
        country: '<%= address.country.name %>',
        countryCode: '<%= address.country.iso %>'
      }
    };
    var button = new SolidusPaypalBraintree.createApplePayButton(applePayButtonElement, applePayOptions);
    button.initialize();
  </script>
<% end %>
